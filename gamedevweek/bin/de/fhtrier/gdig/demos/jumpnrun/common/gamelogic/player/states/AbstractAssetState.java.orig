package de.fhtrier.gdig.demos.jumpnrun.common.gamelogic.player.states;

import org.newdawn.slick.Graphics;
import org.newdawn.slick.Image;
import org.newdawn.slick.SlickException;

import de.fhtrier.gdig.demos.jumpnrun.common.gamelogic.player.Player;
import de.fhtrier.gdig.demos.jumpnrun.identifiers.Assets;
import de.fhtrier.gdig.engine.gamelogic.Entity;
import de.fhtrier.gdig.engine.graphics.entities.AnimationEntity;
import de.fhtrier.gdig.engine.graphics.entities.AssetEntity;
import de.fhtrier.gdig.engine.graphics.shader.Shader;
import de.fhtrier.gdig.engine.management.AssetMgr;
import de.fhtrier.gdig.engine.management.Factory;

public abstract class AbstractAssetState {

	private Factory factory;
	private Player player;
<<<<<<< HEAD
	private AssetEntity gfxEntity;

	public AbstractAssetState(Player player, int animAssetId,
			String animAssetPath, int entityOrder, Factory factory)
			throws SlickException {
=======
	private AssetEntity aGfxEntity;
	private AssetEntity bGfxEntity;
	
	private AssetEntity weaponGfxEntity;
	
	public AbstractAssetState(Player player, int playerAAnimAssetId, int playerBAnimAssetId, String aPlayerAnimAssetPath, String bPlayerAnimAssetPath, int weaponAnimAssetId, String weaponAnimAssetPath, int entityOrder, Factory factory) throws SlickException {
>>>>>>> roessgro/master

		AssetMgr assets = player.getAssetMgr();
		this.player = player;
		this.factory = factory;
<<<<<<< HEAD

		// gfx
		assets.storeAnimation(animAssetId, animAssetPath);
		AnimationEntity anim = getFactory().createAnimationEntity(entityOrder,
				animAssetId, assets);

		anim.getData()[Entity.CENTER_X] = player.getData()[Entity.CENTER_X];
		anim.getData()[Entity.CENTER_Y] = player.getData()[Entity.CENTER_Y];

		anim.setVisible(true);
		setGfxEntity(anim);
=======
		
		assets.storeAnimation(playerAAnimAssetId, aPlayerAnimAssetPath);
		assets.storeAnimation(playerBAnimAssetId, bPlayerAnimAssetPath);
		
		AnimationEntity animA = getFactory().createAnimationEntity(entityOrder, playerAAnimAssetId, assets);
		AnimationEntity animB = getFactory().createAnimationEntity(entityOrder, playerBAnimAssetId, assets);
		
		animA.getData()[Entity.CENTER_X] = player.getData()[Entity.CENTER_X];
		animA.getData()[Entity.CENTER_Y] = player.getData()[Entity.CENTER_Y];
		
		animB.getData()[Entity.CENTER_X] = player.getData()[Entity.CENTER_X];
		animB.getData()[Entity.CENTER_Y] = player.getData()[Entity.CENTER_Y];
		
		assets.storeAnimation(weaponAnimAssetId, weaponAnimAssetPath);
		AnimationEntity weaponAnim = getFactory().createAnimationEntity(entityOrder, weaponAnimAssetId, assets);
		
		weaponAnim.getData()[Entity.CENTER_X] = player.getData()[Entity.CENTER_X];
		weaponAnim.getData()[Entity.CENTER_Y] = player.getData()[Entity.CENTER_Y];
		
		animA.setOrder(Assets.Weapon.WeaponRenderOrder+1);
		animA.setVisible(true);
		animB.setOrder(Assets.Weapon.WeaponRenderOrder+1);
		animB.setVisible(true);
		weaponAnim.setVisible(true);
		weaponAnim.setOrder(Assets.Weapon.WeaponRenderOrder);
		
		
		setGfxEntity(animA, animB, weaponAnim);
>>>>>>> roessgro/master
	}

	public abstract void enter();

	public abstract void leave();

	public abstract void update();

	public Factory getFactory() {
		return factory;
	}

	public void render(Graphics g, Image frameBuffer) {
		
		Shader.pushShader(Player.getColorGlowShader());
		
		Player.getColorGlowShader().setValue("playercolor", player.getPlayerCondition().weaponColor);
		weaponGfxEntity.render(g, frameBuffer);

		Shader.popShader();
		
		getGfxEntity().render(g, frameBuffer);
	}

	public AssetEntity getGfxEntity() {
		if (player.getPlayerCondition().teamId == 1)
			return aGfxEntity;
		return bGfxEntity;
	}
	
	public AssetEntity getAGfxEntity() {
		return aGfxEntity;
	}
	
	public AssetEntity getBGfxEntity() {
		return bGfxEntity;
	}
	
	public AssetEntity getWeaponGfxEntity() {
		return weaponGfxEntity;
	}
<<<<<<< HEAD

	public void setGfxEntity(AssetEntity gfxEntity) {
		this.gfxEntity = gfxEntity;
=======
	
	public void setGfxEntity(AssetEntity playerAGfxEntity, AssetEntity playerBGfxEntity, AssetEntity weaponGfxEntity) {
		this.aGfxEntity = playerAGfxEntity;
		this.bGfxEntity = playerBGfxEntity;
		this.weaponGfxEntity = weaponGfxEntity;
>>>>>>> roessgro/master
	}

	public Player getPlayer() {
		return player;
	}

	@Override
	public String toString() {
		return this.getClass().getSimpleName();
	}
}
